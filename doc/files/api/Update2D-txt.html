<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>2D Firmware Update - 3DTouchPad SDK</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/prettify.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();prettyPrint();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.52 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CSection"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="2D_Firmware_Update"></a>2D Firmware Update</h1><div class=CBody><p>Update of 2D firmware requires a connection to the 2D bootloader device.&nbsp; The 3DTouchPad identifies itself as the 2D bootloader device (VID=04D8, PID=09D3) when it can&rsquo;t start the 2D firmware or if the 2d device was set to the bootloader mode by a call to <a href="../reference/CommonAPI-c.html#hmi2d_update_enter_bootloader" class=LFunction id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">hmi2d_update_enter_bootloader</a>.</p><h4 class=CHeading>Once connected to the 2D bootloader device the update of the 2D firmware involves 3 steps</h4><ul><li>Unlocking the firmware</li><li>Erasing flash memory</li><li>Writing the new firmware</li></ul><p>After the firmware update is complete the bootloader mode could be left by calling <a href="../reference/CommonAPI-c.html#hmi2d_update_exit_bootloader" class=LFunction id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">hmi2d_update_exit_bootloader</a>.&nbsp; Once the bootloader mode is left the normal 2D device is available again.</p><p>The <a href="#2D_Firmware_Update" class=LSection id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">2D Firmware Update</a> application demonstrates how to do a complete firmware update.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#2D_Firmware_Update" >2D Firmware Update</a></td><td class=SDescription>Update of 2D firmware requires a connection to the 2D bootloader device. </td></tr><tr class="SGeneric SIndent1 SMarked"><td class=SEntry><a href="#Connecting_to_2D_bootloader_device" >Connecting to 2D bootloader device</a></td><td class=SDescription>If the 3DTouchPad is already in the bootloader mode it would directly provide the 2D bootloader device for connection. </td></tr><tr class="SGeneric SIndent1"><td class=SEntry><a href="#Unlocking_the_firmware" >Unlocking the firmware</a></td><td class=SDescription></td></tr><tr class="SGeneric SIndent1 SMarked"><td class=SEntry><a href="#Erasing_flash_memory" >Erasing flash memory</a></td><td class=SDescription></td></tr><tr class="SGeneric SIndent1"><td class=SEntry><a href="#Writing_the_new_firmware" >Writing the new firmware</a></td><td class=SDescription></td></tr><tr class="SGeneric SIndent1 SMarked"><td class=SEntry><a href="#Leaving_bootloader_mode" >Leaving bootloader mode</a></td><td class=SDescription></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Connecting_to_2D_bootloader_device"></a>Connecting to 2D bootloader device</h3><div class=CBody><p>If the 3DTouchPad is already in the bootloader mode it would directly provide the 2D bootloader device for connection.&nbsp; Otherwise it is required to connect the normal 2D device and call <a href="../reference/CommonAPI-c.html#hmi2d_update_enter_bootloader" class=LFunction id=link4 onMouseOver="ShowTip(event, 'tt1', 'link4')" onMouseOut="HideTip('tt1')">hmi2d_update_enter_bootloader</a> as follows:</p><blockquote><pre>/* Optional as the combination of VID=04D8, PID=09D3 and report_id=4 is the default */
hmi_hid_set_details(hmi, 0x04d8, 0x09d3, 4);

/* Connect to 2D device */
if(hmi_open(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}

/* Enter bootloader mode */
if(hmi2d_update_enter_bootloader(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}

/* Disconnect from 2D device */
hmi_close(hmi);</pre></blockquote><p>Once the device is set to bootloader mode it identifies itself as the 2D bootloader device.&nbsp; The 2D bootloader device has the same Vendor ID and Report ID as the normal 2D device but the Product ID of 0x9D4 instead of 0x9D3.&nbsp; In theory the device is immediately available for connection.&nbsp; However as the it looks like a different device operating systems have to identify and start the appropriate drivers.&nbsp; This can take some time on Windows systems.&nbsp; When the operating system made the device available the API can connect to it by setting the correct details with <a href="../reference/CommonAPI-c.html#hmi_hid_set_details" class=LFunction id=link5 onMouseOver="ShowTip(event, 'tt4', 'link5')" onMouseOut="HideTip('tt4')">hmi_hid_set_details</a> and calling <a href="../reference/CommonAPI-c.html#hmi_open" class=LFunction id=link6 onMouseOver="ShowTip(event, 'tt5', 'link6')" onMouseOut="HideTip('tt5')">hmi_open</a>:</p><blockquote><pre>/* Set HID-IDs of the 2D bootloader device */
hmi_hid_set_details(hmi, 0x04d8, 0x09d4, 4);

/* Connect to 2D bootloader device */
if(hmi_open(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Unlocking_the_firmware"></a>Unlocking the firmware</h3><div class=CBody><blockquote><pre>/* Unlock 2D firmware */
if(hmi2d_update_unlock(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Erasing_flash_memory"></a>Erasing flash memory</h3><div class=CBody><blockquote><pre>/* Erasing memory */
if(hmi2d_update_erase_memory(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Writing_the_new_firmware"></a>Writing the new firmware</h3><div class=CBody><blockquote><pre>/* Writing new firmware */
if(hmi2d_update_flash_memory(hmi, image) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote><p>It is also possible to write each block individually which allows to provide feedback about the progress.</p><blockquote><pre>/* Writing new firmware */
int i;
for(i = 0; i &lt; HMI2D_PROG_BLOCK_COUNT; ++i) {
    int addr = HMI2D_PROG_MEM_START + i * HMI2D_PROG_BLOCK_SIZE;
    if(hmi2d_update_flash_block(hmi, addr, &amp;image[i]) != HMI_NO_ERROR) {
        /* TODO Handle error */
    }

    /* TODO Give feedback and other actions */
}</pre></blockquote></div></div></div>

<div class="CGeneric"><div class=CTopic><h3 class=CTitle><a name="Leaving_bootloader_mode"></a>Leaving bootloader mode</h3><div class=CBody><blockquote><pre>/* Leave bootloader mode */
if(hmi2d_update_exit_bootloader(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote><blockquote><pre>/* Set HID-details for 2D device */
hmi_hid_set_details(hmi, 0x04d8, 0x09d3, 4);

/* Connect to 2D device */
if(hmi_open(hmi) != HMI_NO_ERROR) {
    /* TODO Handle error */
}</pre></blockquote></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MTitle>3DTouchPad SDK<div class=MSubTitle>0.9.1</div></div><div class=MEntry><div class=MFile><a href="../index-txt.html">Introduction</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">API</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="Compilation-txt.html">Compilation</a></div></div><div class=MEntry><div class=MFile><a href="Usage-txt.html">API Usage</a></div></div><div class=MEntry><div class=MFile><a href="FirstSteps-txt.html">First Steps</a></div></div><div class=MEntry><div class=MFile><a href="DataOut-txt.html">Data Retrieval</a></div></div><div class=MEntry><div class=MFile><a href="RTC-txt.html">Real Time Control</a></div></div><div class=MEntry><div class=MFile><a href="Update3D-txt.html">3D Firmware Update</a></div></div><div class=MEntry><div class=MFile id=MSelected>2D Firmware Update</div></div><div class=MEntry><div class=MFile><a href="FunctionOverview-txt.html">Function Overview</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent5')">Apps</a><div class=MGroupContent id=MGroupContent5><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">2D</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MFile><a href="../apps/2D/fingerpos-txt.html">2D Finger Position Application</a></div></div><div class=MEntry><div class=MFile><a href="../apps/2D/keycombo-txt.html">2D Key Combo Demonstration</a></div></div><div class=MEntry><div class=MFile><a href="../apps/2D/2draw-txt.html">2D Sensor Data Application</a></div></div><div class=MEntry><div class=MFile><a href="../apps/2D/update2d-txt.html">Update2D Application</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent3')">3D</a><div class=MGroupContent id=MGroupContent3><div class=MEntry><div class=MFile><a href="../apps/3D/programmer-txt.html">Programmer Application</a></div></div><div class=MEntry><div class=MFile><a href="../apps/3D/stream-txt.html">Stream Example</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent4')">Mixed</a><div class=MGroupContent id=MGroupContent4><div class=MEntry><div class=MFile><a href="../apps/Mixed/console-txt.html">Console Application</a></div></div></div></div></div><div class=MEntry><div class=MFile><a href="../apps/templates-txt.html">Templates</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent6')">Utilities</a><div class=MGroupContent id=MGroupContent6><div class=MEntry><div class=MFile><a href="../utilities/cdcdriver-txt.html">CDC Driver</a></div></div><div class=MEntry><div class=MFile><a href="../utilities/mgcconv-txt.html">MGCConv</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent7')">Reference</a><div class=MGroupContent id=MGroupContent7><div class=MEntry><div class=MFile><a href="../reference/CommonAPI-c.html">Common API Reference</a></div></div><div class=MEntry><div class=MFile><a href="../reference/DynamicAPI-c.html">Dynamic API Reference</a></div></div><div class=MEntry><div class=MFile><a href="../reference/StaticAPI-c.html">Static API Reference</a></div></div><div class=MEntry><div class=MFile><a href="../reference/Configuration-c.html">Configuration Reference</a></div></div><div class=MEntry><div class=MFile><a href="../reference/Implementation-c.html">Implementation Reference</a></div></div></div></div></div><div class=MEntry><div class=MFile><a href="../changelog-txt.html">Changelog</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent8')">Index</a><div class=MGroupContent id=MGroupContent8><div class=MEntry><div class=MIndex><a href="../../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Constants.html">Constants</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Types.html">Types</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Structs.html">Structs</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Macros.html">Macros</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Constants">Constants</option><option value="Functions">Functions</option><option value="Macros">Macros</option><option value="Structs">Structs</option><option value="Types">Types</option></select></div><script language=JavaScript><!--
HideAllBut([1, 5, 6], 9);// --></script></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>HMI_API int CDECL hmi2d_update_enter_bootloader(</td><td class="PType  prettyprint " nowrap>hmi_t&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap>*</td><td class="PParameter  prettyprint " nowrap>hmi</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Enters the bootloader-mode for 2D firmware update.</div></div><div class=CToolTip id="tt2"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>HMI_API int CDECL hmi2d_update_exit_bootloader(</td><td class="PType  prettyprint " nowrap>hmi_t&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap>*</td><td class="PParameter  prettyprint " nowrap>hmi</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Exits the 2D bootloader mode.</div></div><div class=CToolTip id="tt3"><div class=CSection>Update of 2D firmware requires a connection to the 2D bootloader device. </div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>HMI_API void CDECL hmi_hid_set_details(</td><td class="PType  prettyprint " nowrap>hmi_t&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap>*</td><td class="PParameter  prettyprint " nowrap>hmi,</td></tr><tr><td></td><td class="PType  prettyprint " nowrap>int&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap></td><td class="PParameter  prettyprint " nowrap>vendor_id,</td></tr><tr><td></td><td class="PType  prettyprint " nowrap>int&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap></td><td class="PParameter  prettyprint " nowrap>product_id,</td></tr><tr><td></td><td class="PType  prettyprint " nowrap>int&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap></td><td class="PParameter  prettyprint " nowrap>report_id,</td></tr><tr><td></td><td class="PType  prettyprint " nowrap>int&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap></td><td class="PParameter  prettyprint " nowrap>iface</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Sets the Vendor ID, Product ID, Report ID and Interface that is used by the HID connection.</div></div><div class=CToolTip id="tt5"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class="Prototype"><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class="PBeforeParameters  prettyprint "nowrap>HMI_API int CDECL hmi_open(</td><td class="PType  prettyprint " nowrap>hmi_t&nbsp;</td><td class="PParameterPrefix  prettyprint " nowrap>*</td><td class="PParameter  prettyprint " nowrap>hmi</td><td class="PAfterParameters  prettyprint "nowrap>)</td></tr></table></td></tr></table></blockquote>Opens a connection to the physical device and associates it with hmi that was already initialized with hmi_initialize.</div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>